# Decision Log

<!-- Append entries with ## YYYY-MM-DD - {decision} -->

## 2026-02-22 - ロール分離を最優先アイテム（P1）に設定

**Context**: ステークホルダーから「一人でやり切ってしまう問題がある。別のロール・別のエージェントが客観的にレビューや指摘をすることが重要」と要望があった。Sprint 1レトロでも「全ロールを1人で兼任したため、役割分離の検証ができていない」と課題が記録されている。

**Decision**: 「ロール分離の強制と客観的レビューの実現」を新規アイテムとしてP1に設定。既存アイテムの優先順位を1つずつ下げた（旧P1→P2、旧P2→P3、旧P3→P4、旧P4→P5、旧P5→P6）。

**Rationale**: ロール分離はScrumの「検査」の前提条件であり、これが欠けるとScrumプロセス全体が形骨化する。既存のP1（プロセス動作）やP3（エージェント定義）と関連するが、「強制メカニズム」と「客観的レビューフロー」は独立した課題であり、単独アイテムとすべき。Sprint 1の具体的エビデンスとステークホルダーの明確な要望の両方に裏付けられた優先判断である。

## 2026-02-22 - ロール分離をルールベース（技術的強制ではなく指示ベース）で実装

**Context**: Sprint 2でロール分離を実装するにあたり、2つのアプローチを検討した。(A) Pythonスクリプト/hookによる技術的な強制（兼任検出でブロック）、(B) エージェント定義・セレモニー定義・ルールファイルへの明示的な指示によるルールベースの分離。

**Decision**: (B) ルールベースの分離を採用する。

**Rationale**:
1. Claude Codeのエージェント機構では、Task toolでspawnされたサブエージェントが`.claude/agents/`の定義を読み込む。定義に明確なロール境界を書けば、spawn時に自動的に遵守される。
2. Scrumガイド自体が「自己管理チーム」を前提としており、ルールによる自制はScrumの精神に合致する。
3. Pythonスクリプトの新規作成はこのスキルパッケージの依存を増やし、ツール非依存の設計原則に反する。
4. ルールベースで不十分と判明した場合、Sprint 3以降で技術的強制に昇格させるオプションを残す。

## 2026-02-22 - セレモニー自動連鎖のうち「アーカイブ連鎖」を次スプリントに繰り越し

**Context**: Sprint 3 Review で、セレモニー自動連鎖の AC を検査した。定義ファイルには Auto-trigger/Auto-next が記載されているが、3スプリント経過しても Sprint アーカイブ（`docs/scrum/sprints/YYYY-MM-DD_sprint-NNN/`）が1つも作成されていない。Retro -> Archive -> Reset -> 次 Sprint の連鎖が実動作していない。

**Decision**: この AC を needs-revision とし、次スプリントのバックログに繰り越す。ロール分離の dogfooding（Sprint 3 主目的）は approved として切り離す。

**Rationale**: ロール分離の検証と自動連鎖の実動作は独立した価値であり、前者が達成されたことでスプリント全体を却下する理由はない。一方、3スプリント分のアーカイブが未作成という事実は透明性の観点から看過できず、次スプリントで確実に対応すべき。

## 2026-02-22 - DoD に「PO Review 整合性チェック」を追加

**Context**: Sprint 3 Retrospective の PO クロスロール検証で、SM 推奨「DoD に current.md と PO Review の整合性チェック追加」の検討

**Decision**: 次の2項目を DoD「Scrum」セクションに追加する:
1. `[ ] current.md の Item Status が PO Review 判定と一致している（approved / needs-revision）`
2. `[ ] role-interactions.md に PO Review の履歴（Review Result, Notes）が記録されている`

**Rationale**:
- Sprint 2 で実際に発生した「PO needs-revision 判定が current.md に反映されていない」ケースを構造的に予防
- PO Review の「透明性」（誰が、いつ、何を判定したのか）を可視化
- done の定義が「実装の有無」から「受入検査の有無」にシフト。Scrumの本質（受け入れられるIncrementの生産）に整合

## 2026-02-22 - Sprint 4 優先課題3点を確定

**Context**: Sprint 3 終了時点の状況分析（SM Retrospective + PO Cross-role Verification）

**Decision**: Sprint 4 では以下3点を優先課題として backlog に追加:
1. **セレモニーアーカイブ連鎖の責務明確化** -- 誰が（Agent / PO / SM）、いつ、何をするのかを明記。現在「Auto-trigger / Auto-next」は定義されているが実行責務が曖昧。
2. **Retro 後の自動アーカイブ手順の実装** -- Sprint 1-3 の archives を作成し、current.md をリセット。プロセスの「継続性」を実現。
3. **DoD「PO Review 整合性チェック」の運用検証** -- 追加した2項目が実装時にどう機能するか検証。

**Rationale**:
- 改善ループ（Retro → Backlog → Sprint Goal）が機能していることは Sprint 3 で実証
- 残存課題は「プロセスの完全性」（アーカイブ）と「検査の透明性」（PO Review 記録）
- Sprint 4 で完結すれば、Sprint 1-4 を通じた「Scrum自己導入 → ロール分離 → dogfooding → プロセス完全性」の完全サイクルが達成される

## 2026-02-22 - Sprint 10 後のバックログ再構築（5アイテム独立作成）

**Context**: ステークホルダーから5つの改善要望を受領。同時に「問題点を同時に指摘すると全部同じItemにする」というPOの振る舞いへの指摘があり、各問題を独立したアイテムとして作成することを明示的に求められた。

**Decision**: 5つの独立したバックログアイテム（P19-P23）を作成し、以下の優先順位を設定:
1. P19: 検査チェックポイント強制（最高優先）
2. P20: セッション間コンテキスト継続性
3. P21: バックログアイテム独立性ガイドライン
4. P22: Heartbeat パターン調査（リサーチ）
5. P23: `/scrum update` CLAUDE.md 動作検証（軽量検証）

**Rationale**:
- **P19 最優先**: 検査はScrumの三本柱の一つであり、これが欠けるとプロセス全体が形骸化する。Sprint 3 で繰り返し発生した「Status が done のまま AC が needs-revision」の根本原因に対応。
- **P20 次点**: 継続性はScrumの「透明性」に直結。セッション間でコンテキストが失われるとSprint Goalへの進捗管理が不可能になる。
- **P21 3番目**: PO 自身の振る舞い改善。スキルレベルでの改善なので、このスキルを使う全プロジェクトに波及効果がある。
- **P22 4番目**: リサーチアイテム。ステークホルダーも「別スキルかもしれない」と言及しており、判断材料を集める段階。P19 の結果を踏まえると判断しやすくなる。
- **P23 最低優先**: SKILL.md に定義は存在しており、実装漏れではなく動作検証の問題。軽量な確認で済む可能性が高い。
- **独立性の確保**: 全5アイテムは独立して着手・デリバリー・検査可能。唯一の依存は P22 が P19 の情報を参考にできるという弱い関係のみ。Item Dependency Map をバックログに追加して可視化。

## 2026-02-22 - バージョニングポリシーの策定 (SemVer)

**Context**: Sprint 9 でバージョンを 1.1.0 に設定して以降、Sprint 9-10 でエージェント定義・セレモニー定義に複数の変更を加えたが、バージョンを据え置いたままだった。ステークホルダーから「バージョン上げてないよね？」と指摘。

**Decision**: SemVer に基づくバージョニングポリシーを策定し、DoD に「バージョンバンプ」セクションを追加:
- **Major** (X.0.0): 破壊的変更（ファイル構造変更、機能削除、セレモニーフロー非互換）
- **Minor** (x.Y.0): 新機能（セレモニーステップ追加、エージェント機能追加、テンプレート新セクション）
- **Patch** (x.y.Z): 修正（文言改善、バグ修正、テンプレート微調整、クリーンアップ）

Sprint 11 の変更（検査チェックポイント、継続性、アイテム独立性）は新機能に該当するため、1.1.0 → 1.2.0 にバンプ。

**Rationale**:
- `/scrum update` のバージョン比較が機能しないと、インストール先プロジェクトに変更が反映されない
- DoD に明記することで、今後のスプリントでバージョンバンプ漏れを構造的に防止
- SemVer は広く認知されたポリシーであり、追加の学習コストが低い

## 2026-02-22 - P24 追加とSprint 11 優先順位変更

**Context**: ステークホルダーから P24（バージョンバンプ運用）が最優先と指示。

**Decision**: Sprint 11 のスコープを P24, P19, P20, P21, P23 とし、P24 を最優先にした。P22（Heartbeat調査）は次Sprint に据え置き。

**Rationale**: バージョンバンプが機能しないと他の改善も配布されない。基盤の問題を先に解決する。

## 2026-02-23 - Sprint 11 完了後バックログリファインメント（P25-P27 新規、P22 更新）

**Context**: Sprint 11 で P19, P20, P21, P23, P24 の5アイテムが全て approved で完了。P22（Heartbeat 調査）のみ残存。Sprint 11 Retro で3つの改善点が発見された: (1) `/scrum update` のカスタマイズ削除問題（対策実施済みだが検証未実施）、(2) レトロスペクティブ品質の安定期での低下（Sprint 8-10）、(3) Sprint 中のリアルタイム問題検出の不備。

**Decision**: 3つの新規アイテムを追加し、以下の優先順位を設定:
1. P25: `/scrum update` カスタマイズ保持検証（最高優先）
2. P22: Heartbeat パターン調査（既存、AC 更新）
3. P26: レトロスペクティブ品質の安定化ガイドライン
4. P27: Sprint 中リアルタイム問題検出の改善

P22 の AC を更新: P19 完了を踏まえ「heartbeat が検査の自動トリガーとして付加価値を持つか」の評価観点を追加。依存関係注記も「完了済み」に更新。

**Rationale**:
- **P25 最優先**: Sprint 11 で実際にデータ喪失が発生した問題の再発防止確認。対策は実施されたが、次回 update 時に本当に機能するかの実証がない。「対策したが検証していない」はこのプロジェクトで繰り返し発生してきたパターン（Sprint 3 の dogfooding 未完了、Sprint 8 の grep 確認だけで完了宣言）であり、検証を最優先にすべき。
- **P22 2番目**: ステークホルダーの関心が高いリサーチアイテム。P19 完了により判断材料が揃った。
- **P26 3番目**: Scrum の「適応」の柱を強化。直接のリスクは低いが、長期的なプロセス品質に影響。
- **P27 4番目**: P19 の仕組みが次 Sprint から機能する見込みがあり、追加の仕組みは P19 の実効性を見てから判断しても遅くない。ただし、P19 を補完する位置づけとして定義しておく価値はある。
- **独立性**: 全4アイテムは独立して着手・デリバリー・検査可能。Independence Checklist を適用済み。

## 2026-02-23 - Sprint 8-10 レトロスペクティブ品質分析（P26 根拠）

**Context**: Sprint 11 Retro で「Sprint 8-10 のレトロ品質が低い」と指摘。P26 の根拠としてデータ分析を実施。

**Analysis**:

| Sprint | What To Improve | 具体性 | アクション | 品質評価 |
|--------|----------------|--------|-----------|---------|
| 1 | コミット漏れ、ロール兼任問題 | 高 | 構造的対策提案 | 充実 |
| 2 | ログ漏れ、dogfooding未完了 | 高 | 記録ルール改善 | 充実 |
| 3 | アーカイブ未実行、ステータス不整合 | 高 | 責務定義+DoD改善 | 充実 |
| 4 | dogfooding AC構造問題 | 中 | AC文言改善提案 | 良好 |
| 5 | レビュー品質（不在時） | 中 | 後日レビュー予定 | 良好 |
| 6 | update実動作検証未実施 | 中 | 次回検証予定 | 良好 |
| 7 | リサーチ段階の不足 | 中 | 初期調査ルール | 良好 |
| 8 | 検証レベル（grepのみ） | 低 | 統合テスト課題 | 簡素 |
| 9 | フロー手動化 | 低 | 自動化検討 | 簡素 |
| 10 | 「特になし」 | なし | なし | 不十分 |
| 11 | update破損、レトロ品質、問題検出 | 高 | 3アイテム生成 | 充実 |

**Pattern**: 明確な問題がある Sprint（1-4, 11）はレトロ品質が高い。安定期（8-10）は品質が低下し、「特になし」に至る。問題が発見されないのではなく、探す姿勢が弱い。

**Decision**: SM エージェント定義に「安定期でも最低1つの改善提案」ガイドラインを追加し、sprint-retrospective.md に安定期の改善発見レンズ6項目を追加。

**Rationale**: Scrum の適応の柱は問題がないときにも機能すべき。改善の不在は改善機会の見落とし。
